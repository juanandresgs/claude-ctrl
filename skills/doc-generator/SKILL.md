---
name: doc-generator
description: Generate documentation from parsed decision annotations
---

# Documentation Generator Skill

Generate structured documentation from extracted decision annotations.

## Output Structure

```
docs/decisions/
â”œâ”€â”€ index.md              # Master list with status badges
â”œâ”€â”€ system/               # Cross-cutting ADRs
â”‚   â”œâ”€â”€ ADR-001.md
â”‚   â””â”€â”€ ADR-002.md
â”œâ”€â”€ components/           # Component-specific decisions
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â””â”€â”€ decisions.md
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ decisions.md
â””â”€â”€ graph.json            # Dependency visualization data
```

## Templates

### index.md (Master List)

```markdown
# Architecture Decisions

This documentation is automatically generated from source code annotations.
Do not edit directlyâ€”modify the `@decision` annotations in source files.

Last updated: {timestamp}

## Summary

| Status | Count |
|--------|-------|
| Accepted | {accepted_count} |
| Proposed | {proposed_count} |
| Deprecated | {deprecated_count} |
| Superseded | {superseded_count} |

## All Decisions

| ID | Title | Status | Component |
|----|-------|--------|-----------|
{for each decision}
| [{id}](./{path}/{id}.md) | {title} | {status_badge} | {component} |
{end for}

---
*Generated by Living Documentation System*
```

### Individual Decision (ADR-001.md)

```markdown
# {id}: {title}

**Status**: {status_badge}
**Component**: {component}
**Source**: [{file}:{line}]({relative_path}#L{line})
**Date**: {date}
**Deciders**: {deciders}

## Context

{context}

## Decision

{rationale}

## Consequences

{consequences}

## Alternatives Considered

{alternatives}

## Related Decisions

{for each related}
- [{related_id}](./{related_path}) - {related_title}
{end for}

{if superseded_by}
## Superseded By

This decision has been superseded by [{superseded_by}](./{superseded_path}).
{end if}

---
*Source: [{file}:{line}]({source_url})*
*Generated by Living Documentation System*
```

### Component decisions.md

```markdown
# {component} Decisions

Architectural decisions specific to the {component} component.

## Active Decisions

{for each accepted}
### [{id}]({path}): {title}

{rationale}

*Source: [{file}:{line}]({source_url})*
{end for}

## Deprecated Decisions

{for each deprecated}
### [{id}]({path}): {title}

{rationale}

**Reason for deprecation**: {superseded_by or "No longer applicable"}
{end for}

---
*Generated by Living Documentation System*
```

### graph.json (Visualization Data)

```json
{
  "generated_at": "{timestamp}",
  "nodes": [
    {
      "id": "ADR-001",
      "title": "OAuth2 with PKCE",
      "status": "accepted",
      "component": "auth",
      "file": "src/auth/oauth.ts",
      "line": 42
    }
  ],
  "edges": [
    {
      "from": "ADR-002",
      "to": "ADR-001",
      "type": "supersedes"
    },
    {
      "from": "DEC-AUTH-001",
      "to": "ADR-001",
      "type": "related"
    }
  ]
}
```

## Status Badges

| Status | Badge | Markdown |
|--------|-------|----------|
| accepted | ðŸŸ¢ | `ðŸŸ¢ Accepted` |
| proposed | ðŸŸ¡ | `ðŸŸ¡ Proposed` |
| deprecated | ðŸŸ  | `ðŸŸ  Deprecated` |
| superseded | âš« | `âš« Superseded` |

## Component Detection

Determine component from file path:

| Path Pattern | Component |
|-------------|-----------|
| `src/auth/*` | auth |
| `src/api/*` | api |
| `src/core/*` | core |
| `src/utils/*` | utils |
| `src/components/*` | ui |
| `lib/*` | lib |
| Other | system |

## File Naming

- ADR files: `{id}.md` (e.g., `ADR-001.md`)
- DEC files: `{id}.md` in component directory
- All lowercase, hyphens instead of underscores

## Incremental Generation

When regenerating:
1. Compare existing docs with new extraction
2. Only update changed files
3. Preserve manual additions in designated sections
4. Log all changes for audit

## Reserved Sections

Users can add content to these sections without it being overwritten:

```markdown
## Notes

<!-- User-added notes below this line will be preserved -->
```

## Error Handling

### Missing Output Directory

```bash
mkdir -p docs/decisions/system docs/decisions/components
```

### Write Permission Denied

Report error, do not fail silently:
```json
{
  "error": "WRITE_FAILED",
  "path": "docs/decisions/index.md",
  "reason": "Permission denied"
}
```

### Merge Conflicts

If a file has been manually edited and conflicts with generation:
1. Generate to `.generated.md` suffix
2. Report conflict in summary
3. Let user resolve
